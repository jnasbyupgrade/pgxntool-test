# Make with no ASCIIDOC should not create docs
cp sql/pgxntool-test.sql sql/pgxntool-test--0.1.0.sql
@INSTALL@ -c -d '@PG_LOCATION@/share/extension'
@INSTALL@ -c -d '@PG_LOCATION@/share/doc/extension'
@INSTALL@ -c -m 644 ./sql/pgxntool-test--0.1.0.sql ./sql/pgxntool-test--0.1.0--0.1.1.sql ./pgxntool-test.control  '@PG_LOCATION@/share/extension/'
@INSTALL@ -c -m 644 ./doc/adoc_doc.adoc ./doc/asc_doc.asc ./doc/asciidoc_doc.asciidoc ./doc/other.html '@PG_LOCATION@/share/doc/extension/'
# Make sure missing ASCIIDOC errors out
pgxntool/base.mk:131: Could not find "asciidoc" or "asciidoctor". Add one of them to your PATH,
pgxntool/base.mk:131: or set ASCIIDOC to the correct location.
pgxntool/base.mk:131: *** Could not build %doc/adoc_doc.html.  Stop.
# make returned 2
# Make sure make test with ASCIIDOC works
DOCS is recursive variable set to "doc/adoc_doc.adoc doc/asc_doc.asc doc/asciidoc_doc.asciidoc doc/other.html doc/adoc_doc.html doc/asciidoc_doc.html"
/@ASCIIDOC_PATH@  doc/adoc_doc.adoc
/@ASCIIDOC_PATH@  doc/asciidoc_doc.asciidoc
@INSTALL@ -c -d '@PG_LOCATION@/share/extension'
@INSTALL@ -c -d '@PG_LOCATION@/share/doc/extension'
@INSTALL@ -c -m 644 ./sql/pgxntool-test--0.1.0.sql ./sql/pgxntool-test--0.1.0--0.1.1.sql ./pgxntool-test.control  '@PG_LOCATION@/share/extension/'
@INSTALL@ -c -m 644 ./doc/adoc_doc.adoc ./doc/asc_doc.asc ./doc/asciidoc_doc.asciidoc ./doc/other.html ./doc/adoc_doc.html ./doc/asciidoc_doc.html '@PG_LOCATION@/share/doc/extension/'
INVOCATION OF pg_regress
(using postmaster on XXXX)
============== dropping database "contrib_regression" ==============
DROP DATABASE
============== creating database "contrib_regression" ==============
CREATE DATABASE
ALTER DATABASE
============== running regression test queries        ==============
test pgxntool-test                ... FAILED

======================
 1 of 1 tests failed. 
======================

The differences that caused some tests to fail can be viewed in the
file "@TEST_DIR@/doc_repo/test/regression.diffs".  A copy of the test summary that you see
above is saved in the file "@TEST_DIR@/doc_repo/test/regression.out".

make[1]: [installcheck] Error 1 (ignored)
diff output normalized
--- @TEST_DIR@/repo/test/expected/pgxntool-test.out
++++ @TEST_DIR@/repo/test/results/pgxntool-test.out
@@ -0,0 +1,59 @@
+\i @TEST_DIR@/doc_repo/test/pgxntool/setup.sql
+\i test/pgxntool/psql.sql
+-- No status messages
+\set QUIET true
+-- Verbose error messages
+\set VERBOSITY verbose
+-- Revert all changes on failure.
+\set ON_ERROR_ROLLBACK 1
+\set ON_ERROR_STOP true
+BEGIN;
+\i test/pgxntool/tap_setup.sql
+\i test/pgxntool/psql.sql
+-- No status messages
+\set QUIET true
+-- Verbose error messages
+\set VERBOSITY verbose
+-- Revert all changes on failure.
+\set ON_ERROR_ROLLBACK 1
+\set ON_ERROR_STOP true
+SET client_min_messages = WARNING;
+DO $$
+BEGIN
+IF NOT EXISTS(SELECT 1 FROM pg_namespace WHERE nspname='tap') THEN
+  CREATE SCHEMA tap;
+END IF;
+END$$;
+SET search_path = tap, public;
+CREATE EXTENSION IF NOT EXISTS pgtap SCHEMA tap;
+SET client_min_messages = NOTICE;
+\pset format unaligned
+\pset tuples_only true
+\pset pager
+-- vi: expandtab ts=2 sw=2
+\i test/deps.sql
+-- IF NOT EXISTS will emit NOTICEs, which is annoying
+SET client_min_messages = WARNING;
+-- Add any test dependency statements here
+-- Note: pgTap is loaded by setup.sql
+--CREATE EXTENSION IF NOT EXISTS ...;
+/*
+ * Now load our extension. We don't use IF NOT EXISTs here because we want an
+ * error if the extension is already loaded (because we want to ensure we're
+ * getting the very latest version).
+ */
+CREATE EXTENSION "pgxntool-test";
+-- Re-enable notices
+SET client_min_messages = NOTICE;
+SELECT plan(1);
+1..1
+SELECT is(
+  "pgxntool-test"(1,2)
+  , 3
+);
+ok 1
+\i @TEST_DIR@/doc_repo/test/pgxntool/finish.sql
+SELECT finish();
+\echo # TRANSACTION INTENTIONALLY LEFT OPEN!
+# TRANSACTION INTENTIONALLY LEFT OPEN!
+-- vi: expandtab ts=2 sw=2
# Make sure make clean does not clean docs
rm -rf ../distribution_test-0.1.0.zip sql/pgxntool-test--0.1.0.sql
rm -rf results/ regression.diffs regression.out tmp_check/ tmp_check_iso/ log/ output_iso/
# Make sure make docclean cleans docs
ASCIIDOC_HTML is recursive variable set to "doc/adoc_doc.html doc/asciidoc_doc.html"
DOCS is recursive variable set to "doc/adoc_doc.adoc doc/adoc_doc.html doc/asc_doc.asc doc/asciidoc_doc.asciidoc doc/asciidoc_doc.html doc/other.html doc/adoc_doc.html doc/asciidoc_doc.html"
DOCS_HTML is recursive variable set to "doc/adoc_doc.html doc/asciidoc_doc.html"
rm -f doc/adoc_doc.html doc/asciidoc_doc.html
# Test ASCIIDOC_EXTS='asc'
/@ASCIIDOC_PATH@  doc/asc_doc.asc
/@ASCIIDOC_PATH@  doc/adoc_doc.adoc
/@ASCIIDOC_PATH@  doc/asciidoc_doc.asciidoc
rm -f doc/asc_doc.html doc/adoc_doc.html doc/asciidoc_doc.html
# Ensure things work with no doc directory
/@ASCIIDOC_PATH@  doc/adoc_doc.adoc
/@ASCIIDOC_PATH@  doc/asciidoc_doc.asciidoc
DOCS is recursive variable set to ""
rm -rf  sql/pgxntool-test--0.1.0.sql
rm -rf results/ regression.diffs regression.out tmp_check/ tmp_check_iso/ log/ output_iso/
rm -f 
cp sql/pgxntool-test.sql sql/pgxntool-test--0.1.0.sql
@INSTALL@ -c -d '@PG_LOCATION@/share/extension'
@INSTALL@ -c -m 644 ./sql/pgxntool-test--0.1.0.sql ./sql/pgxntool-test--0.1.0--0.1.1.sql ./pgxntool-test.control  '@PG_LOCATION@/share/extension/'
